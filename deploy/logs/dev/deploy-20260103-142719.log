Starting Dev Deployment at 20260103-142719
--- DXMT Dev Sanity Check ---
Checking AI Gateway configuration...
✅ AI Key appears configured.
Checking running services...
✅ dxmt-ai-service is running.
✅ nginx-proxy-manager is running.
⚠️  mailcow-dockerized-nginx-mailcow-1 is NOT running.
-----------------------------
Loading environment variables...
Loading Mailcow configuration...
Stopping existing containers...
time="2026-01-03T14:27:20+07:00" level=warning msg="The \"GEMINI_API_KEY\" variable is not set. Defaulting to a blank string."
time="2026-01-03T14:27:20+07:00" level=warning msg="/root/dxmtoffice/infrastructure/nginx/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
time="2026-01-03T14:27:20+07:00" level=warning msg="/root/dxmtoffice/office/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Container mailcowdockerized-ofelia-mailcow-1 Stopping 
 Container dxmt-ai-service Stopping 
 Container mailcowdockerized-onlyoffice-app-1 Stopping 
 Container mailcowdockerized-nextcloud-web-1 Stopping 
 Container mailcowdockerized-memcached-mailcow-1 Stopping 
 Container mailcowdockerized-app-1 Stopping 
 Container mailcowdockerized-olefy-mailcow-1 Stopping 
 Container mailcowdockerized-watchdog-mailcow-1 Stopping 
 Container mailcowdockerized-dockerapi-mailcow-1 Stopping 
 Container mailcowdockerized-watchdog-mailcow-1 Stopped 
 Container mailcowdockerized-watchdog-mailcow-1 Removing 
 Container mailcowdockerized-watchdog-mailcow-1 Removed 
 Container mailcowdockerized-postfix-mailcow-1 Stopping 
 Container mailcowdockerized-acme-mailcow-1 Stopping 
 Container mailcowdockerized-ofelia-mailcow-1 Stopped 
 Container mailcowdockerized-ofelia-mailcow-1 Removing 
 Container mailcowdockerized-nextcloud-web-1 Stopped 
 Container mailcowdockerized-nextcloud-web-1 Removing 
 Container mailcowdockerized-ofelia-mailcow-1 Removed 
 Container mailcowdockerized-nextcloud-web-1 Removed 
 Container mailcowdockerized-nextcloud-app-1 Stopping 
 Container mailcowdockerized-memcached-mailcow-1 Stopped 
 Container mailcowdockerized-memcached-mailcow-1 Removing 
 Container mailcowdockerized-acme-mailcow-1 Stopped 
 Container mailcowdockerized-acme-mailcow-1 Removing 
 Container mailcowdockerized-memcached-mailcow-1 Removed 
 Container mailcowdockerized-acme-mailcow-1 Removed 
 Container mailcowdockerized-nginx-mailcow-1 Stopping 
 Container mailcowdockerized-nginx-mailcow-1 Stopped 
 Container mailcowdockerized-nginx-mailcow-1 Removing 
 Container mailcowdockerized-nginx-mailcow-1 Removed 
 Container mailcowdockerized-sogo-mailcow-1 Stopping 
 Container mailcowdockerized-rspamd-mailcow-1 Stopping 
 Container mailcowdockerized-php-fpm-mailcow-1 Stopping 
 Container mailcowdockerized-php-fpm-mailcow-1 Stopped 
 Container mailcowdockerized-php-fpm-mailcow-1 Removing 
 Container mailcowdockerized-nextcloud-app-1 Stopped 
 Container mailcowdockerized-nextcloud-app-1 Removing 
 Container mailcowdockerized-php-fpm-mailcow-1 Removed 
 Container mailcowdockerized-nextcloud-app-1 Removed 
 Container mailcowdockerized-nextcloud-redis-1 Stopping 
 Container mailcowdockerized-nextcloud-db-1 Stopping 
 Container mailcowdockerized-nextcloud-db-1 Stopped 
 Container mailcowdockerized-nextcloud-db-1 Removing 
 Container mailcowdockerized-nextcloud-redis-1 Stopped 
 Container mailcowdockerized-nextcloud-redis-1 Removing 
 Container mailcowdockerized-nextcloud-db-1 Removed 
 Container mailcowdockerized-nextcloud-redis-1 Removed 
 Container mailcowdockerized-dockerapi-mailcow-1 Stopped 
 Container mailcowdockerized-dockerapi-mailcow-1 Removing 
 Container mailcowdockerized-dockerapi-mailcow-1 Removed 
 Container mailcowdockerized-app-1 Stopped 
 Container mailcowdockerized-app-1 Removing 
 Container mailcowdockerized-app-1 Removed 
 Container mailcowdockerized-db-1 Stopping 
 Container mailcowdockerized-postfix-mailcow-1 Stopped 
 Container mailcowdockerized-postfix-mailcow-1 Removing 
 Container mailcowdockerized-postfix-mailcow-1 Removed 
 Container mailcowdockerized-postfix-tlspol-mailcow-1 Stopping 
 Container mailcowdockerized-sogo-mailcow-1 Stopped 
 Container mailcowdockerized-sogo-mailcow-1 Removing 
 Container mailcowdockerized-sogo-mailcow-1 Removed 
 Container mailcowdockerized-postfix-tlspol-mailcow-1 Stopped 
 Container mailcowdockerized-postfix-tlspol-mailcow-1 Removing 
 Container mailcowdockerized-postfix-tlspol-mailcow-1 Removed 
 Container mailcowdockerized-olefy-mailcow-1 Stopped 
 Container mailcowdockerized-olefy-mailcow-1 Removing 
 Container mailcowdockerized-olefy-mailcow-1 Removed 
 Container dxmt-ai-service Stopped 
 Container dxmt-ai-service Removing 
 Container mailcowdockerized-onlyoffice-app-1 Stopped 
 Container mailcowdockerized-onlyoffice-app-1 Removing 
 Container dxmt-ai-service Removed 
 Container mailcowdockerized-onlyoffice-app-1 Removed 
 Container mailcowdockerized-db-1 Stopped 
 Container mailcowdockerized-db-1 Removing 
 Container mailcowdockerized-db-1 Removed 
 Container mailcowdockerized-rspamd-mailcow-1 Stopped 
 Container mailcowdockerized-rspamd-mailcow-1 Removing 
 Container mailcowdockerized-rspamd-mailcow-1 Removed 
 Container mailcowdockerized-clamd-mailcow-1 Stopping 
 Container mailcowdockerized-dovecot-mailcow-1 Stopping 
 Container mailcowdockerized-dovecot-mailcow-1 Stopped 
 Container mailcowdockerized-dovecot-mailcow-1 Removing 
 Container mailcowdockerized-dovecot-mailcow-1 Removed 
 Container mailcowdockerized-redis-mailcow-1 Stopping 
 Container mailcowdockerized-mysql-mailcow-1 Stopping 
 Container mailcowdockerized-clamd-mailcow-1 Stopped 
 Container mailcowdockerized-clamd-mailcow-1 Removing 
 Container mailcowdockerized-clamd-mailcow-1 Removed 
 Container mailcowdockerized-redis-mailcow-1 Stopped 
 Container mailcowdockerized-redis-mailcow-1 Removing 
 Container mailcowdockerized-redis-mailcow-1 Removed 
 Container mailcowdockerized-mysql-mailcow-1 Stopped 
 Container mailcowdockerized-mysql-mailcow-1 Removing 
 Container mailcowdockerized-mysql-mailcow-1 Removed 
 Container mailcowdockerized-unbound-mailcow-1 Stopping 
 Container mailcowdockerized-netfilter-mailcow-1 Stopping 
 Container mailcowdockerized-unbound-mailcow-1 Stopped 
 Container mailcowdockerized-unbound-mailcow-1 Removing 
 Container mailcowdockerized-unbound-mailcow-1 Removed 
 Container mailcowdockerized-netfilter-mailcow-1 Stopped 
 Container mailcowdockerized-netfilter-mailcow-1 Removing 
 Container mailcowdockerized-netfilter-mailcow-1 Removed 
 Network mailcowdockerized_mailcow-network Removing 
 Network mailcowdockerized_infrastructure_default Removing 
 Network mailcowdockerized_office-network Removing 
 Network mailcowdockerized_infrastructure_default Removed 
 Network mailcowdockerized_office-network Removed 
 Network mailcowdockerized_mailcow-network Removed 
Cleaning up Docker resources (Aggressive)...
Ensuring host environment is ready...
Configuring host DNS (8.8.8.8)...
Configuring UFW...
Killing any process on ports 80, 443, 53, 25, 465, 587, 143, 993, 995, 8080-8082, 3000...
Cleaning file artifacts and PERFORMING RESTORATION...
Clearing mailcow/data/conf/unbound/unbound.conf to ensure correct restoration...
Clearing mailcow/data/conf/redis/redis-conf.sh to ensure correct restoration...
Restoring Mailcow configuration files...
⚠️  Missing core Mailcow data or configs. Attempting auto-repair...
Cloning core files from upstream...
Restoring data/conf defaults (Unbound)...
✅ Core data and defaults restored.
Configuration files restored and cleaned.
Deploying services fresh...
time="2026-01-03T14:28:23+07:00" level=warning msg="The \"GEMINI_API_KEY\" variable is not set. Defaulting to a blank string."
time="2026-01-03T14:28:23+07:00" level=warning msg="/root/dxmtoffice/infrastructure/nginx/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
time="2026-01-03T14:28:23+07:00" level=warning msg="/root/dxmtoffice/office/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Image mailcowdockerized-ai-service Building 
#1 [internal] load local bake definitions
#1 reading from stdin 542B done
#1 DONE 0.0s

#2 [internal] load build definition from Dockerfile
#2 transferring dockerfile: 159B 0.0s done
#2 DONE 0.0s

#3 [internal] load metadata for docker.io/library/node:20-alpine
#3 DONE 2.2s

#4 [internal] load .dockerignore
#4 transferring context: 2B done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 91B done
#5 DONE 0.0s

#6 [1/5] FROM docker.io/library/node:20-alpine@sha256:658d0f63e501824d6c23e06d4bb95c71e7d704537c9d9272f488ac03a370d448
#6 resolve docker.io/library/node:20-alpine@sha256:658d0f63e501824d6c23e06d4bb95c71e7d704537c9d9272f488ac03a370d448 0.0s done
#6 DONE 0.0s

#7 [4/5] RUN npm install
#7 CACHED

#8 [2/5] WORKDIR /app
#8 CACHED

#9 [3/5] COPY package*.json ./
#9 CACHED

#10 [5/5] COPY . .
#10 CACHED

#11 exporting to image
#11 exporting layers done
#11 exporting manifest sha256:4c0df1509a27d94693f0c628762cb4b3af18c05ac8562af4ff166d23694b15c3 done
#11 exporting config sha256:fb734f74c4d68a0242319c4854868925cb6fc327da55167c4b9baca62cfe64a0 done
#11 exporting attestation manifest sha256:2cfe6bcab85ea0cd57df5bf801f2616a3c1f72bdd7d7d514679527d4619b3585 done
#11 exporting manifest list sha256:d79698b017fd4dd0ae39fb50906bf779e5aca19e5c883d14b366f575de29f80c done
#11 naming to docker.io/library/mailcowdockerized-ai-service:latest done
#11 unpacking to docker.io/library/mailcowdockerized-ai-service:latest 0.0s done
#11 DONE 0.1s

#12 resolving provenance for metadata file
#12 DONE 0.0s
 Image mailcowdockerized-ai-service Built 
 Network mailcowdockerized_office-network Creating 
 Network mailcowdockerized_office-network Created 
 Network mailcowdockerized_infrastructure_default Creating 
 Network mailcowdockerized_infrastructure_default Created 
 Network mailcowdockerized_mailcow-network Creating 
 Network mailcowdockerized_mailcow-network Created 
 Container mailcowdockerized-unbound-mailcow-1 Creating 
 Container mailcowdockerized-nextcloud-redis-1 Creating 
 Container mailcowdockerized-sogo-mailcow-1 Creating 
 Container mailcowdockerized-olefy-mailcow-1 Creating 
 Container dxmt-ai-service Creating 
 Container mailcowdockerized-db-1 Creating 
 Container mailcowdockerized-netfilter-mailcow-1 Creating 
 Container mailcowdockerized-memcached-mailcow-1 Creating 
 Container mailcowdockerized-onlyoffice-app-1 Creating 
 Container mailcowdockerized-dockerapi-mailcow-1 Creating 
 Container mailcowdockerized-nextcloud-db-1 Creating 
time="2026-01-03T14:28:27+07:00" level=warning msg="mount of type `volume` should not define `bind` option"
 Container mailcowdockerized-olefy-mailcow-1 Created 
 Container mailcowdockerized-unbound-mailcow-1 Created 
 Container mailcowdockerized-clamd-mailcow-1 Creating 
 Container mailcowdockerized-postfix-tlspol-mailcow-1 Creating 
 Container dxmt-ai-service Created 
 Container mailcowdockerized-netfilter-mailcow-1 Created 
 Container mailcowdockerized-redis-mailcow-1 Creating 
 Container mailcowdockerized-mysql-mailcow-1 Creating 
time="2026-01-03T14:28:27+07:00" level=warning msg="mount of type `volume` should not define `bind` option"
 Container mailcowdockerized-sogo-mailcow-1 Created 
 Container mailcowdockerized-dockerapi-mailcow-1 Created 
 Container mailcowdockerized-db-1 Created 
 Container mailcowdockerized-app-1 Creating 
 Container mailcowdockerized-memcached-mailcow-1 Created 
 Container mailcowdockerized-nextcloud-redis-1 Created 
 Container mailcowdockerized-nextcloud-db-1 Created 
 Container mailcowdockerized-nextcloud-app-1 Creating 
 Container mailcowdockerized-clamd-mailcow-1 Created 
 Container mailcowdockerized-postfix-tlspol-mailcow-1 Created 
 Container mailcowdockerized-mysql-mailcow-1 Created 
 Container mailcowdockerized-postfix-mailcow-1 Creating 
time="2026-01-03T14:28:27+07:00" level=warning msg="mount of type `volume` should not define `bind` option"
 Container mailcowdockerized-redis-mailcow-1 Created 
 Container mailcowdockerized-php-fpm-mailcow-1 Creating 
time="2026-01-03T14:28:27+07:00" level=warning msg="mount of type `volume` should not define `bind` option"
 Container mailcowdockerized-dovecot-mailcow-1 Creating 
time="2026-01-03T14:28:27+07:00" level=warning msg="mount of type `volume` should not define `bind` option"
 Container mailcowdockerized-nextcloud-app-1 Created 
 Container mailcowdockerized-nextcloud-web-1 Creating 
 Container mailcowdockerized-app-1 Created 
 Container mailcowdockerized-postfix-mailcow-1 Created 
 Container mailcowdockerized-php-fpm-mailcow-1 Created 
 Container mailcowdockerized-dovecot-mailcow-1 Created 
 Container mailcowdockerized-ofelia-mailcow-1 Creating 
 Container mailcowdockerized-rspamd-mailcow-1 Creating 
 Container mailcowdockerized-nextcloud-web-1 Created 
 Container mailcowdockerized-rspamd-mailcow-1 Created 
 Container mailcowdockerized-nginx-mailcow-1 Creating 
 Container mailcowdockerized-ofelia-mailcow-1 Created 
 Container mailcowdockerized-nginx-mailcow-1 Created 
 Container mailcowdockerized-acme-mailcow-1 Creating 
time="2026-01-03T14:28:27+07:00" level=warning msg="mount of type `volume` should not define `bind` option"
 Container mailcowdockerized-acme-mailcow-1 Created 
 Container mailcowdockerized-watchdog-mailcow-1 Creating 
time="2026-01-03T14:28:27+07:00" level=warning msg="mount of type `volume` should not define `bind` option"
 Container mailcowdockerized-watchdog-mailcow-1 Created 
 Container mailcowdockerized-onlyoffice-app-1 Created 
 Container mailcowdockerized-memcached-mailcow-1 Starting 
 Container mailcowdockerized-db-1 Starting 
 Container mailcowdockerized-nextcloud-redis-1 Starting 
 Container mailcowdockerized-olefy-mailcow-1 Starting 
 Container mailcowdockerized-onlyoffice-app-1 Starting 
 Container mailcowdockerized-dockerapi-mailcow-1 Starting 
 Container mailcowdockerized-nextcloud-db-1 Starting 
 Container dxmt-ai-service Starting 
 Container mailcowdockerized-sogo-mailcow-1 Starting 
 Container mailcowdockerized-unbound-mailcow-1 Starting 
 Container mailcowdockerized-netfilter-mailcow-1 Starting 
 Container mailcowdockerized-memcached-mailcow-1 Started 
 Container mailcowdockerized-nextcloud-db-1 Started 
 Container mailcowdockerized-netfilter-mailcow-1 Started 
 Container mailcowdockerized-redis-mailcow-1 Starting 
 Container mailcowdockerized-sogo-mailcow-1 Started 
 Container mailcowdockerized-olefy-mailcow-1 Started 
 Container mailcowdockerized-unbound-mailcow-1 Started 
 Container mailcowdockerized-clamd-mailcow-1 Starting 
 Container mailcowdockerized-mysql-mailcow-1 Starting 
 Container mailcowdockerized-postfix-tlspol-mailcow-1 Starting 
 Container mailcowdockerized-dockerapi-mailcow-1 Started 
 Container mailcowdockerized-nextcloud-redis-1 Started 
 Container mailcowdockerized-nextcloud-app-1 Starting 
 Container mailcowdockerized-db-1 Started 
 Container mailcowdockerized-app-1 Starting 
 Container dxmt-ai-service Started 
 Container mailcowdockerized-onlyoffice-app-1 Started 
 Container mailcowdockerized-redis-mailcow-1 Started 
 Container mailcowdockerized-php-fpm-mailcow-1 Starting 
 Container mailcowdockerized-postfix-tlspol-mailcow-1 Started 
 Container mailcowdockerized-mysql-mailcow-1 Started 
 Container mailcowdockerized-postfix-mailcow-1 Starting 
 Container mailcowdockerized-dovecot-mailcow-1 Starting 
 Container mailcowdockerized-clamd-mailcow-1 Started 
 Container mailcowdockerized-app-1 Started 
 Container mailcowdockerized-php-fpm-mailcow-1 Started 
 Container mailcowdockerized-nextcloud-app-1 Started 
 Container mailcowdockerized-nextcloud-web-1 Starting 
 Container mailcowdockerized-dovecot-mailcow-1 Started 
 Container mailcowdockerized-ofelia-mailcow-1 Starting 
 Container mailcowdockerized-rspamd-mailcow-1 Starting 
 Container mailcowdockerized-postfix-mailcow-1 Started 
 Container mailcowdockerized-nextcloud-web-1 Started 
 Container mailcowdockerized-ofelia-mailcow-1 Started 
 Container mailcowdockerized-rspamd-mailcow-1 Started 
 Container mailcowdockerized-nginx-mailcow-1 Starting 
 Container mailcowdockerized-nginx-mailcow-1 Started 
 Container mailcowdockerized-acme-mailcow-1 Starting 
 Container mailcowdockerized-acme-mailcow-1 Started 
 Container mailcowdockerized-watchdog-mailcow-1 Starting 
 Container mailcowdockerized-watchdog-mailcow-1 Started 
Verifying deployment...
--- DXMT Healthcheck ---
✅ Nginx Proxy Manager (80) is UP
✅ NPM Admin UI (81) is UP
✅ SSL Gateway (443) is UP
✅ Postfix (SMTP) (25) is UP
✅ Submission (SMTP) (587) is UP
✅ IMAP (Plain) (143) is UP
✅ IMAP (Secure) (993) is UP
✅ SMTP (SSL) (465) is UP
✅ POP3 (Secure) (995) is UP
✅ Mailcow UI (Internal) (8080) is UP
✅ Nextcloud (Internal) (8081) is UP
✅ OnlyOffice (Internal) (8082) is UP
✅ AI Service (Internal) (3000) is UP
-----------------------
Archiving logs...
