include:
  - infrastructure/nginx/docker-compose.yml
  - mailcow/docker-compose.yml
  - office/docker-compose.yml

services:
  ai-service:
    build: ./ai/service
    container_name: dxmt-ai-service
    ports:
      - "3000:3000"
    environment:
      - DEV_MODE=true
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - AI_LOG_ENABLED=true
    networks:
      - infrastructure_default

  # Note: Mailcow ports are controlled by mailcow.conf (HTTP_PORT=8080, HTTPS_PORT=8443)
  # No manual override here to avoid "double mapping" or "Bind failed" errors.

  # Office Port Overrides - ensure they match the containers internal ports
  nextcloud-web:
    ports:
      - "8081:80"

  onlyoffice-app:
    ports:
      - "8082:80"
